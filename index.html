<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clarity Board</title>
    <link rel="icon" type="image/x-icon" href="src/assets/favicon/256.ico">
    <link rel="stylesheet" href="src/css/styles.css">
    <link rel="stylesheet" href="src/css/board.css">
    <link rel="stylesheet" href="src/css/modal.css">
    <link rel="stylesheet" href="src/css/start-screen.css">
    <script>
        // IIFE to set the theme before the page renders, preventing FOUC
        (function () {
            try {
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = savedTheme || (prefersDark ? 'dark' : 'light');
                document.documentElement.setAttribute('data-theme', theme);
            } catch (e) {
                // In case of any error (e.g., localStorage access denied), fallback to light
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    </script>
</head>

<body>
    <header>
        <div class="header-content-wrapper">
            <div class="header-left">
                <img src="src/assets/clarity-board-logo.svg" alt="ClarityBoard Logo" class="logo">
            </div>
            <div class="header-right">
                <div class="header-controls">
                    <div class="project-selector">
                        <select id="projectSelect">
                            <option value="" data-i18n="header.project_select">Select Project ▼</option>
                        </select>
                    </div>
                    <button id="manageCategoriesBtn" class="header-btn" title="Manage Categories"
                        data-i18n-title="modal.category.title" data-i18n="header.categories">
                        Categories
                    </button>
                    <button id="importProjectBtn" class="header-btn" data-i18n="header.import">Import Project</button>
                    <input type="file" id="importProjectInput" style="display: none;" accept=".json">
                    <button id="exportProjectBtn" class="header-btn" data-i18n="header.export">Export Project</button>
                    <button id="settingsBtn" class="header-btn" title="Settings" data-i18n-title="settings.title"
                        data-i18n="header.settings">
                        Settings
                    </button>
                    <button id="themeToggle" class="theme-toggle" title="Toggle Dark/Light Mode">
                        <div class="theme-icon-container">
                            <!-- Sun Icon -->
                            <svg class="theme-icon sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                            <!-- Moon Icon -->
                            <svg class="theme-icon moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                        </div>
                    </button>
                    <div class="color-indicators">
                        <span class="indicator-label" data-i18n="header.priority">Priority:</span>
                        <div class="color-dot high" title="High Priority"></div>
                        <div class="color-dot medium" title="Medium Priority"></div>
                        <div class="color-dot low" title="Low Priority"></div>
                    </div>
                </div>
                <button id="menuToggle" class="menu-toggle" title="Toggle Menu">
                    <span class="hamburger-icon"></span>
                </button>
            </div>
        </div>
    </header>

    <main id="boardContainer">
        <div class="board-nav-buttons">
            <button id="prev-board" class="board-nav-btn prev" aria-label="Previous Board">&lsaquo;</button>
            <button id="next-board" class="board-nav-btn next" aria-label="Next Board">&rsaquo;</button>
        </div>
        <div class="loading-state">
            <h2 data-i18n="board.loading">Loading Board...</h2>
            <div class="spinner"></div>
        </div>
    </main>

    <!-- Mobile Navigation Drawer -->
    <nav id="mobileNav" class="mobile-nav">
        <button id="closeMenu" class="close-menu" title="Close Menu">&times;</button>
        <div class="mobile-nav-content">
            <div class="project-selector">
                <label>Project</label>
                <select id="mobileProjectSelect">
                    <option value="">Select Project ▼</option>
                </select>
            </div>

            <!-- Mobile Action Buttons -->
            <div class="mobile-nav-buttons">
                <button id="mobileCategoriesBtn" class="mobile-nav-btn" data-i18n="header.categories">
                    Categories
                </button>
                <button id="mobileImportBtn" class="mobile-nav-btn" data-i18n="header.import">
                    Import Project
                </button>
                <button id="mobileExportBtn" class="mobile-nav-btn" data-i18n="header.export">
                    Export Project
                </button>
                <button id="mobileSettingsBtn" class="mobile-nav-btn" data-i18n="header.settings">
                    Settings
                </button>
            </div>

            <div class="theme-toggle-group">
                <label>Theme</label>
                <button id="mobileThemeToggle" class="theme-toggle" title="Toggle Dark/Light Mode">
                    <div class="theme-icon-container">
                        <!-- Sun Icon -->
                        <svg class="theme-icon sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="5"></circle>
                            <line x1="12" y1="1" x2="12" y2="3"></line>
                            <line x1="12" y1="21" x2="12" y2="23"></line>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                            <line x1="1" y1="12" x2="3" y2="12"></line>
                            <line x1="21" y1="12" x2="23" y2="12"></line>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                        </svg>
                        <!-- Moon Icon -->
                        <svg class="theme-icon moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                        </svg>
                    </div>
                </button>
            </div>
        </div>
    </nav>
    <div id="menuOverlay" class="menu-overlay"></div>

    <!-- Floating Action Button -->
    <button id="fabAddTask" class="fab" title="Add New Task">+</button>

    <div id="projectModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="project">&times;</span>
            <h2 data-i18n="modal.project.title">Create New Project</h2>
            <form id="projectForm">
                <div class="form-group">
                    <label data-i18n="modal.project.details">Project Details: *</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div style="position: relative;">
                            <button type="button" id="emojiPickerBtn" class="emoji-picker-btn"
                                title="Select Icon">✒️</button>
                            <input type="hidden" id="selectedEmoji" value="">
                            <div id="emojiPickerMenu" class="emoji-picker-menu">
                                <!-- Emojis will be injected here -->
                            </div>
                        </div>
                        <input type="text" id="projectName" data-i18n-placeholder="modal.project.name_placeholder"
                            placeholder="Enter project name" required style="flex: 1;">
                    </div>
                </div>
                <div class="form-group">
                    <label for="projectType" data-i18n="modal.project.type_label">Category Type: *</label>
                    <select id="projectType" required>
                        <option value="non-numeric" selected data-i18n="modal.project.type_text">Text-based Categories
                            (Standard)</option>
                        <!-- Future Implementation: Numeric Projects -->
                        <option value="numeric" disabled style="display: none;" data-i18n="modal.project.type_numeric">
                            Numeric Categories (Unavailable)
                        </option>
                    </select>
                    <small style="display: none;" data-i18n="modal.project.numeric_help">Choose "Numeric" if you want to
                        track quantities or numeric values in
                        your tasks.</small>
                </div>
                <button type="submit" data-i18n="modal.project.create_btn">Create Project</button>
            </form>
        </div>
    </div>

    <!-- Modal para gerenciar categorias -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="category">&times;</span>
            <h2 data-i18n="modal.category.title">Manage Categories</h2>
            <div id="categoryList" class="category-list"></div>
            <hr>
            <h3 data-i18n="modal.category.add_new">Add New Category</h3>
            <form id="categoryForm">
                <div class="form-group">
                    <label for="categoryName" data-i18n="modal.category.name_label">Category Name: *</label>
                    <input type="text" id="categoryName" data-i18n-placeholder="modal.category.name_placeholder"
                        placeholder="e.g., Design, Development, Testing" maxlength="100" required>
                </div>
                <div class="form-group">
                    <label for="categoryImportance" data-i18n="modal.category.importance_label">Importance (0-10):
                        *</label>
                    <div class="range-container">
                        <input type="range" id="categoryImportance" min="0" max="10" value="5" class="slider">
                        <span id="importanceValue">5</span>
                    </div>
                </div>
                <div class="form-group">
                    <label data-i18n="modal.category.color_label">Category Color:</label>
                    <div id="colorPickerGrid" class="color-picker-grid">
                        <!-- Colors will be injected here -->
                    </div>
                    <input type="hidden" id="categoryColor" value="#4A90E2">
                </div>
                <button type="submit" data-i18n="modal.category.add_btn">Add Category</button>
            </form>
        </div>
    </div>

    <!-- Modal para criar tarefa -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="task">&times;</span>
            <h2 id="modalTitle" data-i18n="modal.task.create_title">Create New Task</h2>
            <form id="taskForm">
                <input type="hidden" id="taskId">
                <div class="form-group">
                    <label for="taskName" data-i18n="modal.task.name_label">Task Name: *</label>
                    <input type="text" id="taskName" data-i18n-placeholder="modal.task.name_placeholder"
                        placeholder="Enter task name" required>
                </div>
                <div class="form-group">
                    <label for="taskDescription" data-i18n="modal.task.desc_label">Description:</label>
                    <textarea id="taskDescription" rows="3" data-i18n-placeholder="modal.task.desc_placeholder"
                        placeholder="Describe the task..."></textarea>
                </div>
                <div class="form-group" style="position: relative;">
                    <label for="taskCategoryInput" data-i18n="modal.task.category_label">Category:</label>
                    <div class="input-icon-wrapper">
                        <div id="selectedCategoryDot" class="input-color-dot"></div>
                        <input type="text" id="taskCategoryInput"
                            data-i18n-placeholder="modal.task.category_placeholder"
                            placeholder="Select or type to create..." autocomplete="off">
                        <button type="button" id="confirmCategoryBtn" class="confirm-category-btn"
                            title="Confirm Category">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"
                                stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </button>
                    </div>
                    <div id="categoryDropdown" class="custom-dropdown"></div>
                    <input type="hidden" id="taskCategory">
                    <small><span data-i18n="modal.task.category_help">Type and press Enter to create a new
                            category.</span> <a href="#" id="manageCategoriesLink"
                            data-i18n="modal.task.category_manage">Manage</a></small>
                </div>
                <div class="form-group" id="numericGroup" style="display: none;">
                    <label for="taskNumeric" data-i18n="modal.task.numeric_label">Numeric Value:</label>
                    <input type="number" id="taskNumeric" data-i18n-placeholder="modal.task.numeric_placeholder"
                        placeholder="Enter numeric value" step="0.01">
                </div>
                <!-- Schedule Field -->
                <div class="form-group">
                    <label for="taskSchedule" data-i18n="modal.task.schedule_label">Schedule:</label>
                    <input type="date" id="taskSchedule" class="schedule-input">
                </div>
                <div class="form-group">
                    <label for="taskDeadline" data-i18n="modal.task.deadline_label">Deadline:</label>
                    <input type="date" id="taskDeadline">
                </div>
                <div class="form-group">
                    <label data-i18n="modal.task.urgency_label">Urgency:</label>
                    <div class="urgency-selector">
                        <div class="urgency-dot low" data-value="low" title="Low Urgency"></div>
                        <div class="urgency-dot medium" data-value="medium" title="Medium Urgency"></div>
                        <div class="urgency-dot high" data-value="high" title="High Urgency"></div>
                    </div>
                    <input type="hidden" id="taskUrgency">
                </div>
                <div class="form-group">
                    <label for="taskStatus" data-i18n="modal.task.status_label">Status:</label>
                    <select id="taskStatus" required>
                        <option value="backlog" selected data-i18n="board.backlog">Backlog</option>
                        <option value="selected" data-i18n="board.selected">Selected</option>
                        <option value="progress" data-i18n="board.progress">In Progress</option>
                        <option value="done" data-i18n="board.done">Done</option>
                    </select>
                </div>
                <button type="submit" id="submitTaskBtn" data-i18n="modal.task.create_btn">Create Task</button>
            </form>
        </div>
    </div>

    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <span class="close" data-modal="settings">&times;</span>
            <h2 data-i18n="settings.title">Settings</h2>
            <form id="settingsForm">
                <div style="margin-bottom: 12px;">
                    <h3 style="margin-bottom: 6px; font-size: 14px; color: var(--text-secondary); font-weight: 600;"
                        data-i18n="settings.project_settings">Project Settings</h3>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label style="font-size: 13px; margin-bottom: 4px;" data-i18n="settings.project_details">Project
                            Details</label>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <div style="position: relative;">
                                <button type="button" id="settingsEmojiPickerBtn" class="emoji-picker-btn"
                                    title="Select Icon">✒️</button>
                                <input type="hidden" id="settingsSelectedEmoji" value="">
                                <div id="settingsEmojiPickerMenu" class="emoji-picker-menu">
                                    <!-- Emojis will be injected here -->
                                </div>
                            </div>
                            <input type="text" id="settingsProjectName"
                                data-i18n-placeholder="modal.project.name_placeholder" placeholder="Enter project name"
                                required style="flex: 1;">
                        </div>
                    </div>
                </div>

                <hr style="margin: 12px 0; border: 0; border-top: 1px solid var(--border-primary);">

                <div class="form-group">
                    <label for="settingsLanguage" data-i18n="settings.language">Language:</label>
                    <select id="settingsLanguage">
                        <option value="en-US">English (US)</option>
                        <option value="pt-BR">Português (BR)</option>
                    </select>
                </div>
                <!-- Scoring Weights Section -->
                <h3 style="margin: 12px 0 8px 0; font-size: 14px; font-weight: 600;" data-i18n="settings.weights">
                    Scoring Weights</h3>
                <div class="form-group">
                    <label for="urgencyWeight" data-i18n="settings.urgency_weight">Urgency Weight:</label>
                    <div class="range-container">
                        <input type="range" id="urgencyWeight" min="0" max="10" step="1" value="1">
                        <span id="urgencyWeightValue">1</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="categoriesWeight" data-i18n="settings.categories_weight">Categories Weight:</label>
                    <div class="range-container">
                        <input type="range" id="categoriesWeight" min="0" max="10" step="1" value="1">
                        <span id="categoriesWeightValue">1</span>
                    </div>
                </div>
                <div class="formula-preview">
                    <small><em data-i18n="settings.formula">Score = (Urgency × Urgency Weight) + (Category Importance ×
                            Category Weight)</em></small>
                </div>
                <button type="submit" data-i18n="settings.save">Save Settings</button>

                <hr style="margin: 16px 0; border: 0; border-top: 1px solid var(--border-primary);">

                <!-- Danger Zone -->
                <div class="danger-zone">
                    <h3 data-i18n="settings.danger_zone">Danger Zone</h3>
                    <p data-i18n="settings.danger_desc">Irreversible actions for this project.</p>
                    <button type="button" id="deleteProjectBtn" class="btn-danger"
                        data-i18n="settings.delete_project">Delete Project</button>
                </div>
            </form>
        </div>
    </div>

    <div id="deleteProjectModal" class="modal">
        <div class="modal-content modal-danger">
            <h2 data-i18n="modal.delete_project.title">Delete Project</h2>
            <p class="danger-warning" data-i18n="modal.delete_project.warning">This action <strong>cannot be
                    undone</strong>. This will permanently delete the project
                and all its tasks and categories.</p>

            <div class="form-group">
                <label for="deleteProjectConfirmInput">
                    <span data-i18n="modal.delete_project.confirm_label">Please type</span>
                    <strong id="deleteProjectNameDisplay"></strong>
                    <span data-i18n="modal.delete_project.confirm_suffix">to confirm.</span>
                </label>
                <input type="text" id="deleteProjectConfirmInput" placeholder="" autocomplete="off">
            </div>

            <div class="modal-actions">
                <button id="cancelDeleteProjectBtn" class="btn-secondary"
                    data-i18n="modal.delete_project.cancel">Cancel</button>
                <button id="confirmDeleteProjectBtn" class="btn-danger-confirm" disabled
                    data-i18n="modal.delete_project.delete">Delete Project</button>
            </div>
        </div>
    </div>

    <!-- Modal for initial choice -->
    <div id="initialChoiceModal" class="modal initial-modal">
        <div class="modal-content">
            <h2 data-i18n="modal.welcome.title">Welcome to Clarity Board!</h2>
            <p data-i18n="modal.welcome.desc">What would you like to do?</p>
            <div class="initial-choices">
                <button id="initialCreateBtn" class="choice-btn" data-i18n="modal.welcome.create">Create New
                    Project</button>
                <button id="initialImportBtn" class="choice-btn" data-i18n="modal.welcome.import">Import
                    Project</button>
            </div>
        </div>
    </div>

    <footer>
        <p data-i18n="footer.copyright">ClarityBoard &copy; 2025</p>
        <div class="footer-contact">
            <a href="https://github.com/maxadobr" target="_blank" rel="noopener noreferrer" title="GitHub"
                class="footer-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-github"
                    viewBox="0 0 16 16">
                    <path
                        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27s1.36.09 2 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0 0 16 8c0-4.42-3.58-8-8-8" />
                </svg>
            </a>
            <a href="https://www.linkedin.com/in/maxadobr/" target="_blank" rel="noopener noreferrer" title="LinkedIn"
                class="footer-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                    class="bi bi-linkedin" viewBox="0 0 16 16">
                    <path
                        d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854zm4.943 12.248V6.169H2.542v7.225zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248S2.4 3.226 2.4 3.934c0 .694.521 1.248 1.327 1.248zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016l.016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225z" />
                </svg>
            </a>
            <a href="https://maxadobr.github.io/" target="_blank" rel="noopener noreferrer" title="Portfolio"
                class="footer-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor"
                    class="bi bi-browser-chrome" viewBox="0 0 16 16">
                    <path fill-rule="evenodd"
                        d="M16 8a8 8 0 0 1-7.022 7.94l1.902-7.098a3 3 0 0 0 .05-1.492A3 3 0 0 0 10.237 6h5.511A8 8 0 0 1 16 8M0 8a8 8 0 0 0 7.927 8l1.426-5.321a3 3 0 0 1-.723.255 3 3 0 0 1-1.743-.147 3 3 0 0 1-1.043-.7L.633 4.876A8 8 0 0 0 0 8m5.004-.167L1.108 3.936A8.003 8.003 0 0 1 15.418 5H8.066a3 3 0 0 0-1.252.243 2.99 2.99 0 0 0-1.81 2.59M8 10a2 2 0 1 0 0-4 2 2 0 0 0 0 4" />
                </svg>
            </a>
        </div>
    </footer>
    <script type="module" src="src/js/app.js"></script>
</body>

</html>